# 개발 환경. H2 인메모리 + Redis 미사용 + 세션 none. 환경 변수 없이 실행 가능.
spring:
  config:
    activate:
      on-profile: dev
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
  datasource:
    url: ${DB_URL:jdbc:h2:mem:devdb;MODE=MySQL;DB_CLOSE_DELAY=-1}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:}
    driver-class-name: ${DB_DRIVER:org.h2.Driver}
    hikari:
      initialization-fail-timeout: ${DB_INIT_FAIL_TIMEOUT:-1}
  h2:
    console:
      enabled: true
      path: /h2-console
  sql:
    init:
      data-locations: classpath:data/test_data.sql
      mode: always
  jpa:
    defer-datasource-initialization: true
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:create-drop}
    properties:
      hibernate:
        format_sql: ${HIBERNATE_FORMAT_SQL:false}
    open-in-view: false
  session:
    store-type: none

server:
  port: ${SERVER_PORT:8080}

# RULE 1.4.3: 개발 환경 DEBUG, 파일 보관 30일
# Windows 콘솔 한글 깨짐 방지 (UTF-8)
logging:
  charset:
    console: UTF-8
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} │ %highlight(%-5level) │ [%X{traceId:-}] [%X{spanId:-}] │ %cyan(%-20logger{20}) │ %msg%n"
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    com.example: ${LOG_LEVEL_APP:DEBUG}
  file:
    name: ${LOG_FILE_PATH:./logs/app.log}
  logback:
    rollingpolicy:
      max-file-size: 50MB
      max-history: 30
      file-name-pattern: ./logs/app-%d{yyyy-MM-dd}.%i.log

# RULE 6.1.4, 6.5: JWT·CORS·지도·Rate Limit·업로드
app:
  cookie:
    secure: false
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:8080,http://localhost:5173,http://127.0.0.1:8080,http://127.0.0.1:5173}
  jwt:
    access-ttl-minutes: ${JWT_ACCESS_TTL_MINUTES:15}
    refresh-ttl-days: ${JWT_REFRESH_TTL_DAYS:7}
    issuer: ${JWT_ISSUER:local-issuer}
    audience: ${JWT_AUDIENCE:local-audience}
    secret-key: ${JWT_SECRET_KEY:local-secret-key-min-256-bits-for-hs256-encoding}
  map:
    provider: ${MAP_PROVIDER:none}
    timeout-seconds: ${MAP_TIMEOUT_SECONDS:5}
    retry-count: ${MAP_RETRY_COUNT:2}
    google-api-key: ${MAP_GOOGLE_API_KEY:}
    kakao-api-key: ${MAP_KAKAO_API_KEY:}
    kakao-mobility-api-key: ${MAP_KAKAO_MOBILITY_API_KEY:${MAP_KAKAO_API_KEY:}}
    kakao-js-app-key: ${MAP_KAKAO_JS_APP_KEY:}
    kakao-origin: ${MAP_KAKAO_ORIGIN:http://localhost:5173}
    naver-client-id: ${MAP_NAVER_CLIENT_ID:}
    naver-client-secret: ${MAP_NAVER_CLIENT_SECRET:}
  rate-limit:
    login-capacity: ${RATE_LIMIT_LOGIN_CAPACITY:10}
    login-period-minutes: ${RATE_LIMIT_LOGIN_PERIOD:1}
    signup-capacity: ${RATE_LIMIT_SIGNUP_CAPACITY:10}
    signup-period-minutes: ${RATE_LIMIT_SIGNUP_PERIOD:1}
    refresh-capacity: ${RATE_LIMIT_REFRESH_CAPACITY:20}
    refresh-period-minutes: ${RATE_LIMIT_REFRESH_PERIOD:5}
    public-api-capacity: ${RATE_LIMIT_PUBLIC_API_CAPACITY:100}
    public-api-period-minutes: ${RATE_LIMIT_PUBLIC_API_PERIOD:1}
  upload:
    base-path: ${UPLOAD_BASE_PATH:./uploads}
    allowed-mime-types:
      - image/jpeg
      - image/png
      - image/gif
      - image/webp
    max-file-size-bytes: ${UPLOAD_MAX_FILE_SIZE:5242880}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized
